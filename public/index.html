<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ä¸‰å°éš»æ—¥å¸¸ç™¾è²¨ï½œç™‚ç™’ç”Ÿæ´»ç™¾è²¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
      background: #fff9ec; /* å¥¶æ²¹ç±³è‰²åº• */
      color: #4f3b2a;
      line-height: 1.6;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(255, 249, 236, 0.95);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid #ffe3aa;
    }

    .nav {
      max-width: 1100px;
      margin: 0 auto;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      font-size: 18px;
      color: #e59b29;
    }

    .logo-badge {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ffe3a7, #fff4ce);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .nav-links {
      display: flex;
      gap: 16px;
      font-size: 14px;
    }

    .nav-links a {
      padding: 6px 10px;
      border-radius: 999px;
      transition: background 0.2s, transform 0.1s;
    }

    .nav-links a:hover {
      background: #fff0c6;
      transform: translateY(-1px);
    }

    .nav-action {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
    }

    .btn-primary {
      padding: 6px 14px;
      border-radius: 999px;
      background: linear-gradient(135deg, #f4b73e, #ffd37a);
      border: none;
      color: #3f2b14;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(220, 158, 35, 0.35);
      transition: transform 0.1s, box-shadow 0.1s;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(220, 158, 35, 0.45);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(220, 158, 35, 0.3);
    }

    .btn-secondary {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #e0c080;
      background: #fff9ec;
      font-size: 13px;
      cursor: pointer;
    }

    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
    }

    /* Hero å€å¡Š */
    .hero {
      margin-top: 16px;
      border-radius: 24px;
      background: radial-gradient(circle at top left, #ffe9b8 0, #fff9ec 40%, #fffdf5 100%);
      padding: 24px 20px;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.5fr);
      gap: 16px;
      align-items: center;
      box-shadow: 0 10px 30px rgba(216, 164, 79, 0.35);
    }

    .hero-text h1 {
      font-size: 26px;
      color: #e59b29;
      margin-bottom: 8px;
    }

    .hero-text h2 {
      font-size: 16px;
      color: #7b5b30;
      margin-bottom: 14px;
    }

    .hero-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 14px;
    }

    .hero-tag {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.85);
      border: 1px dashed #ffd88a;
      color: #c58419;
    }

    .hero-desc {
      font-size: 14px;
      color: #6b502c;
      margin-bottom: 16px;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .hero-secondary {
      font-size: 12px;
      color: #9a7641;
    }

    .hero-badge-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
      color: #8b6a3b;
    }

    .hero-badge {
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid #ffe3aa;
    }

    .hero-visual {
      position: relative;
      padding: 12px;
    }

    .hero-visual .hero-badge {
      position: absolute;
      top: 0;
      right: 10px;
    }

    /* é€šç”¨æ¨™é¡Œ & åˆ†é¡ */
    .section-title {
      margin-top: 28px;
      margin-bottom: 10px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #e59b29;
    }

    .section-title span {
      font-size: 12px;
      color: #9a7641;
    }

    .category-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .category-chip {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #ffdf9b;
      background: #fffdf5;
      font-size: 13px;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
    }

    .category-chip.active {
      background: linear-gradient(135deg, #f4b73e, #ffd37a);
      border-color: transparent;
      color: #3f2b14;
    }

    /* === è¦çš®å•†å“ç‰†ï¼šPC 5 æ¬„ã€æ‰‹æ©Ÿ 2 æ¬„ === */
    .product-grid {
      margin-top: 14px;
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 14px;
    }

    .product-card {
      position: relative;
      cursor: pointer;
      padding: 8px;
      border-radius: 12px;
      background: #fffef8;
      box-shadow: 0 2px 8px rgba(171, 132, 77, 0.18);
      display: flex;
      flex-direction: column;
      gap: 4px;
      transition: transform 0.1s, box-shadow 0.1s;
    }

    .product-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(171, 132, 77, 0.25);
    }

    .product-tag {
      position: absolute;
      top: 6px;
      left: 6px;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(255, 242, 205, 0.95);
      border: 1px solid #ffd98b;
      color: #c58419;
    }

    .product-img {
      width: 100%;
      position: relative;
      padding-top: 100%;          /* 1:1 æ–¹å½¢ */
      border-radius: 10px;
      overflow: hidden;
      background: #fff7df;
      margin-bottom: 4px;
    }

    .product-img img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }

    .product-name {
      font-size: 12px;
      font-weight: 600;
      color: #4f3b2a;
      line-height: 1.4;
      min-height: 32px;
      max-height: 34px;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .product-desc {
      display: none;
    }

    .product-bottom {
      margin-top: 2px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .product-price-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
    }

    .product-price {
      font-size: 14px;
      font-weight: 700;
      color: #e08a1e;
    }

    .product-like-btn {
      border: none;
      background: transparent;
      font-size: 14px;
      cursor: pointer;
      color: #e59b29;
    }

    .product-like-btn.active {
      color: #e63946;
    }

    /* å°æ¬¾å¼åˆ—ï¼ˆæœ‰å¤šæ¬¾æ‰é¡¯ç¤ºï¼‰ */
    .card-spec-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 2px;
    }

    .card-spec-btn {
      border-radius: 999px;
      border: 1px solid #f0d9a4;
      background: #fffcf3;
      padding: 2px 6px;
      font-size: 10px;
      cursor: pointer;
      white-space: nowrap;
    }

    .card-spec-btn.active {
      border-color: #f4b73e;
      background: #fff7df;
    }

    /* æ•¸é‡ + åŠ å…¥è³¼ç‰©è»Šï¼ˆè¦çš®æ’ç‰ˆï¼‰ */
    .card-action-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
    }

    .qty-control {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      border: 1px solid #f0d9a4;
      overflow: hidden;
      background: #fffcf3;
    }

    .qty-btn {
      width: 22px;
      height: 22px;
      border: none;
      background: transparent;
      font-size: 14px;
      cursor: pointer;
      line-height: 1;
    }

    .qty-input {
      width: 30px;
      border: none;
      text-align: center;
      font-size: 12px;
      background: transparent;
      outline: none;
    }

    .btn-cart {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #fff7df;
      color: #bd7f1f;
      border: 1px solid #ffd98b;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    /* å€å¡Šå¡ç‰‡å…±ç”¨ */
    .card {
      margin-top: 26px;
      border-radius: 18px;
      background: #fffef8;
      padding: 16px 14px;
      box-shadow: 0 4px 16px rgba(171, 132, 77, 0.25);
    }

    .card p {
      font-size: 13px;
      color: #6b502c;
      margin-bottom: 6px;
    }

    .card ul {
      padding-left: 18px;
      font-size: 13px;
      color: #7a5c3a;
    }

    .card li {
      margin-bottom: 4px;
    }

    /* è¨‚å–®æŸ¥è©¢çµæœ */
    .order-result {
      margin-top: 10px;
      padding: 10px;
      border-radius: 10px;
      font-size: 13px;
      background: #fffdf2;
      border: 1px dashed #f0d9a4;
      display: none;
    }

    .order-result.success {
      border-style: solid;
      border-color: #8fbc50;
      background: #f7ffe9;
      color: #486022;
    }

    .order-result.error {
      border-color: #e5a03d;
      color: #7b4c16;
    }

    /* å•†å“è©³æƒ…ï¼ˆé€šç”¨æ¨¡æ¿ï¼‰ */
    .product-detail {
      margin-top: 26px;
      display: none;
    }

    .pd-layout {
	display: grid;
	/* å·¦é‚Šåœ–ç‰‡ è®Šå¯¬ã€å³é‚Šèªªæ˜ç¨å¾®ç¸®ä¸€é» */
	grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.1fr);
	gap: 20px;
	align-items: flex-start;
	}

    .pd-images {
  background: #fffdf5;
  border-radius: 14px;
  padding: 14px;
  border: 1px solid #f0d9a4;
}

.pd-main-img {
  width: 100%;
  border-radius: 12px;
  background: #fff7df;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px;
  margin-bottom: 10px;
}

/* ä¸»åœ–é«˜åº¦åŠ å¤§ï¼ˆåŸæœ¬å¤§æ¦‚ 360pxï¼‰ */
.pd-main-img img {
  max-width: 100%;
  max-height: 520px;  /* æƒ³æ›´å¤§å¯ä»¥å†å¾€ä¸ŠåŠ ï¼Œä¾‹å¦‚ 600px */
  object-fit: cover;
  border-radius: 10px;
}

    .pd-thumbs {
  display: flex;
  gap: 10px;    /* é–“è·ç¨å¾®åŠ å¤§ä¸€é» */
  flex-wrap: wrap;
}

/* ç¸®åœ–ç”± 64x64 â†’ 90x90 */
.pd-thumb-btn {
  width: 90px;
  height: 90px;
  border-radius: 8px;
  overflow: hidden;
  border: 2px solid #f0d9a4;
  background: #fff7df;
  padding: 0;
  cursor: pointer;
}

.pd-thumb-btn.active {
  border-color: #f4b73e;
}

.pd-thumb-btn img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
    .pd-info-title {
      font-size: 18px;
      font-weight: 700;
      color: #4f3b2a;
      margin-bottom: 4px;
    }

    .pd-info-sub {
      font-size: 12px;
      color: #9a7641;
      margin-bottom: 8px;
    }

    .pd-price {
      font-size: 20px;
      font-weight: 700;
      color: #e08a1e;
      margin-bottom: 8px;
    }

    .pd-price span {
      font-size: 12px;
      font-weight: 400;
      color: #9a7641;
      margin-left: 6px;
    }

    /* åƒ¹æ ¼ä¸»å­—é«”ï¼šè®“é‡‘é¡è®Šå¤§ */
    .pd-price #detailPrice {
      font-size: inherit;
      font-weight: inherit;
      color: inherit;
    }

    /* åƒ¹æ ¼å‰¯æ¨™ï¼ˆä¿æŒåŸæœ¬å°å­—ï¼‰ */
    .pd-price #detailPriceNote {
      font-size: 12px;
      font-weight: 400;
      color: #9a7641;
      margin-left: 6px;
    }

    .pd-spec-title {
      font-size: 13px;
      color: #6b502c;
      margin-bottom: 4px;
    }

    .pd-spec-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .pd-spec-btn {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #f0d9a4;
      background: #fffcf3;
      font-size: 13px;
      cursor: pointer;
    }

    .pd-spec-btn.active {
      border-color: #f4b73e;
      background: #fff7df;
    }

    .pd-desc-detail {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed #f0d9a4;
      font-size: 13px;
      color: #6b502c;
      white-space: pre-line;
    }

    footer {
      margin-top: 30px;
      padding: 16px;
      font-size: 11px;
      text-align: center;
      color: #a17f48;
    }

    footer a {
      color: #e59b29;
    }

    @media (max-width: 768px) {
      .nav {
        flex-wrap: wrap;
        justify-content: center;
      }

      .hero {
        grid-template-columns: 1fr;
      }

      .hero-visual {
        order: -1;
      }

      .pd-layout {
        grid-template-columns: 1fr;
      }

      .product-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
	  .pd-main-img img {
    max-height: 420px;  /* æ‰‹æ©Ÿä¸Šç¨å¾®é™ä¸€é»é«˜åº¦ */
	}

	.pd-thumb-btn {
    width: 80px;
    height: 80px;
	}
    }
  </style>
</head>

<body>

<header>
  <div class="nav">
    <div class="logo">
      <div class="logo-badge">â˜€</div>
      ä¸‰å°éš»æ—¥å¸¸å°ç‰©ç™¾è²¨
    </div>

    <nav class="nav-links">
      <a href="#products">å•†å“</a>
      <a href="#checkout">çµå¸³</a>
      <a href="#order-query">è¨‚å–®æŸ¥è©¢</a>
      <a href="#about">å“ç‰Œæ•…äº‹</a>
    </nav>

    <div class="nav-action">
      <button class="btn-primary" onclick="scrollToSection('cart')">æŸ¥çœ‹è³¼ç‰©è»Šï¼ˆ0ï¼‰</button>
    </div>
  </div>
</header>

<main>

  <!-- Hero å€å¡Š -->
  <section class="hero">
    <div class="hero-text">
      <h1>æŠŠæ¯å¤©éæˆæš–æš–å¥¶æ²¹è‰² â™¡</h1>
      <h2>æ¯å­ã€æŠ±æ•ã€å°æ‰˜ç›¤ã€æ¡Œä¸Šå°ç‰©ï¼Œç”¨æº«æŸ”å¥¶æ²¹é»ƒæŠŠæ—¥å¸¸åŒ…èµ·ä¾†ã€‚</h2>

      <div class="hero-tag-row">
        <div class="hero-tag">æ»¿ NT$699 è¶…å•†å…é‹</div>
        <div class="hero-tag">ç„¡éœ€è¨»å†Šæœƒå“¡ï¼Œä¸€æ¬¡å¡«å¯«å°±èƒ½ä¸‹å–®</div>
        <div class="hero-tag">ç•™ä¸‹ Email / Lineï¼Œå‡ºè²¨ä¸»å‹•é€šçŸ¥ä½ </div>
      </div>

      <p class="hero-desc">
        æˆ‘å€‘æ˜¯æ²’æœ‰å£“åŠ›çš„ã€Œå°å‹ç™‚ç™’é¸ç‰©åº—ã€ã€‚  
        ä¸å¼·è¿«ä½ åŠ å…¥æœƒå“¡ã€ä¸å¡ä¸€å †è¦å‰‡ã€‚  
        åªå¸Œæœ›ä½ å¶çˆ¾æƒ³è®“ç”Ÿæ´»æŸ”è»Ÿä¸€é»æ™‚ï¼Œæœƒæƒ³åˆ°é€™è£¡ã€‚
      </p>

      <div class="hero-actions">
        <button class="btn-primary" onclick="scrollToSection('products')">é€›é€›ä»Šå¤©ä¸Šæ–°å“</button>
        <span class="hero-secondary">å…ˆæŒ‘å–œæ­¡çš„å°ç‰©ï¼Œç­‰ä¸€ä¸‹ä¸€èµ·åˆ°çµå¸³å€å¡«è³‡æ–™å³å¯ã€‚</span>
      </div>

      <div class="hero-badge-row">
        <div class="hero-badge">ğŸ§ˆ å¥¶æ²¹é»ƒä¸»é¡Œ</div>
        <div class="hero-badge">â˜• ä¸‹ç­ä¹Ÿéœ€è¦è¢«ç™‚ç™’</div>
        <div class="hero-badge">ğŸ“® Email / Line å‡ºè²¨æé†’</div>
      </div>
    </div>

    <div class="hero-visual">
      <div class="hero-badge">æœ¬é€±ä¸»æ‰“ï¼šå¥¶æ²¹æ¡Œé¢ä¸‹åˆèŒ¶çµ„ âœ¨</div>
    </div>
  </section>

  <!-- åˆ†é¡ -->
  <section>
    <h3 class="section-title">
      å•†å“åˆ†é¡
      <span>é¸ä¸€å€‹ä½ æƒ³è¢«ç™‚ç™’çš„è§’è½é–‹å§‹é€›</span>
    </h3>

    <div class="category-row">
      <button class="category-chip active" data-category="all">å…¨éƒ¨</button>
      <button class="category-chip" data-category="cup">æ¯ç›¤é¤å…·</button>
      <button class="category-chip" data-category="room">æˆ¿é–“ä½ˆç½®</button>
      <button class="category-chip" data-category="desk">æ¡Œä¸Šå°ç‰©</button>
      <button class="category-chip" data-category="gift">é€ç¦®å°ç‰©</button>
    </div>
  </section>

  <!-- å•†å“åˆ—è¡¨ï¼ˆç”± JS è‡ªå‹•ç”¢ç”Ÿï¼‰ -->
  <section id="products">
    <h3 class="section-title">
      ç²¾é¸å•†å“
      <span>å•†å“åˆ—è¡¨èˆ‡è©³æƒ…éƒ½å¾åŒä¸€ä»½è³‡æ–™ç”¢ç”Ÿ</span>
    </h3>

    <div class="product-grid" id="productGrid"></div>
  </section>

  <!-- é€šç”¨å•†å“è©³æƒ…å€ï¼ˆé»ä»»ä½•å•†å“éƒ½ç”¨é€™ä¸€å¡Šï¼‰ -->
  <section class="card product-detail" id="productDetail">
    <h3 class="section-title">
      <span id="detailTitlePrefix">å•†å“è©³æƒ…ï½œ</span><span id="detailTitleMain"></span>
      <span id="detailSubtitle"> </span>
    </h3>

    <div class="pd-layout">
      <!-- å·¦ï¼šåœ–ç‰‡ -->
      <div class="pd-images">
        <div class="pd-main-img">
          <img id="detailMainImg" src="" alt="">
        </div>
        <div class="pd-thumbs" id="detailThumbs"></div>
      </div>

      <!-- å³ï¼šè³‡è¨Š -->
      <div>
        <div class="pd-info-title" id="detailName"></div>
        <div class="pd-info-sub" id="detailSub"></div>

        <div class="pd-price">
          NT$ <span id="detailPrice">0</span>
          <span id="detailPriceNote"></span>
        </div>

        <div>
          <div class="pd-spec-title">é¸æ“‡æ¬¾å¼</div>
          <div class="pd-spec-options" id="detailSpecs"></div>
        </div>

        <!-- æ•¸é‡ + åŠ å…¥è³¼ç‰©è»Šï¼ˆè©³æƒ…ç‰ˆï¼ŒåŒæ¨£åˆä½µåˆ°è³¼ç‰©è»Šï¼‰ -->
        <div style="margin-top:8px;display:flex;flex-wrap:wrap;gap:10px;align-items:center;">
          <div class="qty-control" id="detailQtyControl">
            <button type="button" class="qty-btn" id="detailQtyMinus">âˆ’</button>
            <input type="text" class="qty-input" id="detailQtyInput" value="1">
            <button type="button" class="qty-btn" id="detailQtyPlus">ï¼‹</button>
          </div>

          <button type="button" class="btn-primary" id="detailAddBtn">
            ğŸ›’ åŠ å…¥è³¼ç‰©è»Š
          </button>

          <button type="button" class="btn-secondary" onclick="backToProducts()">
            â† å›åˆ°å•†å“åˆ—è¡¨
          </button>
        </div>

        <div class="pd-desc-detail" id="detailDesc"></div>
      </div>
    </div>
  </section>

  <!-- è³¼ç‰©è»Šé é¢ -->
  <section class="card" id="cart">
    <h3 class="section-title">
      è³¼ç‰©è»Š
      <span>æŸ¥çœ‹ä½ å‰›å‰›åŠ å…¥çš„å°ç‰©</span>
    </h3>

    <div id="cartList" style="font-size:13px; color:#6b502c;">
      ï¼ˆä½ çš„è³¼ç‰©è»Šç›®å‰æ˜¯ç©ºçš„ï¼‰  
    </div>

    <div class="form-actions" style="margin-top:14px;">
      <button type="button" class="btn-primary" onclick="scrollToSection('checkout')">
        å‰å¾€çµå¸³
      </button>
      <button type="button" class="btn-secondary" onclick="backToProducts()">
        ç¹¼çºŒé€›é€›
      </button>
    </div>
  </section>

  <!-- çµå¸³å€ -->
  <section class="card" id="checkout">
    <h3 class="section-title">
      çµå¸³è³‡è¨Šï¼ˆç„¡éœ€è¨»å†Šæœƒå“¡ï¼‰
      <span>ä¸€æ¬¡å¡«å¯«ï¼Œä¹‹å¾Œé€é Email / Line é€šçŸ¥ä½ å‡ºè²¨</span>
    </h3>

    <p>
      æˆ‘å€‘ä¸åšè¤‡é›œçš„æœƒå“¡ç³»çµ±ï¼Œåªéœ€è¦ä½ åœ¨é€™è£¡å¡«å¯«ä¸€æ¬¡ï¼Œ  
      å°±å¯ä»¥å®Œæˆè¨‚å–®ã€‚<br>
      <strong>Email / Line ID æœƒç”¨ä¾†ï¼š</strong>
    </p>
    <ul>
      <li>é€šçŸ¥ä½ ã€Œè¨‚å–®æˆç«‹ / å‡ºè²¨ / åˆ°åº—æé†’ã€</li>
      <li>å¶çˆ¾åˆ†äº«æ–°å“æˆ–æŠ˜æ‰£ï¼ˆå¯ä»¥è«‹æˆ‘å€‘åœæ­¢é€šçŸ¥ï¼‰</li>
    </ul>

    <form id="checkoutForm">
      <div class="form-row">
        <div>
          <label for="checkoutName">æ”¶ä»¶äººå§“åï¼ˆå¿…å¡«ï¼‰</label>
          <input type="text" id="checkoutName" required>
        </div>
        <div>
          <label for="checkoutPhone">æ‰‹æ©Ÿè™Ÿç¢¼ï¼ˆå¿…å¡«ï¼‰</label>
          <input type="tel" id="checkoutPhone" required placeholder="ä¾‹ï¼š09xxxxxxxx">
          <div class="form-hint">ä¹‹å¾ŒæŸ¥è¨‚å–®æœƒç”¨åˆ°é€™æ”¯é›»è©±ã€‚</div>
        </div>
      </div>

      <div class="form-row">
        <div>
          <label for="checkoutEmail">Emailï¼ˆå¿…å¡«ï¼‰</label>
          <input type="email" id="checkoutEmail" required placeholder="ä¾‹ï¼šyou@example.com">
          <div class="form-hint">æœƒå¯„é€è¨‚å–®æ˜ç´°èˆ‡å‡ºè²¨é€šçŸ¥ã€‚</div>
        </div>
        <div>
          <label for="checkoutLine">Line IDï¼ˆé¸å¡«ï¼‰</label>
          <input type="text" id="checkoutLine" placeholder="è‹¥å¡«å¯«ï¼Œå°‡å„ªå…ˆç”¨ Line é€šçŸ¥">
        </div>
      </div>

      <div>
        <label for="checkoutAddress">æ”¶ä»¶åœ°å€ï¼ˆè‹¥é¸å®…é…ï¼‰</label>
        <input type="text" id="checkoutAddress" placeholder="è¶…å•†å–è²¨å¯å¡«ï¼šè¶…å•† + é–€å¸‚åç¨±">
      </div>

      <div class="form-row">
        <div>
          <label for="checkoutShip">é…é€æ–¹å¼</label>
          <select id="checkoutShip">
            <option value="711">è¶…å•†å–è²¨ï¼ˆ7-11ï¼‰</option>
            <option value="family">è¶…å•†å–è²¨ï¼ˆå…¨å®¶ï¼‰</option>
            <option value="home">å®…é…åˆ°åºœ</option>
          </select>
        </div>
        <div>
          <label for="checkoutPay">ä»˜æ¬¾æ–¹å¼</label>
          <select id="checkoutPay">
            <option value="cod">è²¨åˆ°ä»˜æ¬¾ï¼ˆè¶…å•†ï¼å®…é…ï¼‰</option>
            <option value="transfer">éŠ€è¡Œè½‰å¸³</option>
            <option value="card">ä¿¡ç”¨å¡ï¼ˆå¾…é–‹é€šï¼‰</option>
          </select>
        </div>
      </div>

      <div>
        <label for="checkoutNote">å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
        <textarea id="checkoutNote" placeholder="ä¾‹å¦‚ï¼šå¸Œæœ›ç›¡é‡å¹«æˆ‘åœ¨ 18:00 å‰é€é”ï¼Œæˆ–æ˜¯å…¶ä»–å°æé†’ã€‚"></textarea>
      </div>

      <div class="form-note">
        â€» ç›®å‰ç‚ºæ¸¬è©¦ç‰ˆï¼šæŒ‰ä¸‹é€å‡ºå¾Œï¼Œæœƒåœ¨ç³»çµ±ä¸­å»ºç«‹ä¸€ç­†è¨‚å–®ç´€éŒ„ï¼Œ  
        è‹¥æ˜¯æ­£å¼ç‡Ÿé‹å‰çš„æ¸¬è©¦ï¼Œå¯ä»¥éš¨æ„å¤šè©¦å¹¾æ¬¡æ²’é—œä¿‚ã€‚
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary">é€å‡ºè¨‚å–®</button>
        <button type="button" class="btn-secondary" onclick="backToProducts()">
          é‚„æƒ³å†å¤šé€›ä¸€ä¸‹
        </button>
      </div>
    </form>
  </section>

  <!-- è¨‚å–®æŸ¥è©¢ -->
  <section class="card" id="order-query">
    <h3 class="section-title">
      è¨‚å–®æŸ¥è©¢
      <span>è¼¸å…¥é›»è©±èˆ‡è¨‚å–®ç·¨è™Ÿï¼Œè‡ªè¡ŒæŸ¥çœ‹è¨‚å–®ç‹€æ…‹</span>
    </h3>

    <p>
      ä¹‹å¾ŒçœŸæ­£ä¸Šç·šæ™‚ï¼Œé¡§å®¢å¯ä»¥åœ¨é€™è£¡ç”¨ï¼š  
      <strong>æ‰‹æ©Ÿè™Ÿç¢¼ + è¨‚å–®ç·¨è™Ÿ</strong> æŸ¥è©¢è‡ªå·±çš„è¨‚å–®ï¼Œä¸éœ€è¦ç™»å…¥æœƒå“¡ã€‚
    </p>

    <form id="orderQueryForm">
      <div class="form-row">
        <div>
          <label for="queryPhone">æ‰‹æ©Ÿè™Ÿç¢¼</label>
          <input type="tel" id="queryPhone" required placeholder="ä¾‹ï¼š09xxxxxxxx">
        </div>
        <div>
          <label for="queryOrderId">è¨‚å–®ç·¨è™Ÿ</label>
          <input type="text" id="queryOrderId" required placeholder="ä¾‹ï¼šND20250001">
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary">æŸ¥è©¢è¨‚å–®</button>
        <div class="form-hint">
          ç¤ºæ„è³‡æ–™ï¼šé›»è©±å¯è¼¸å…¥ <strong>0912345678</strong>ï¼Œè¨‚å–®ç·¨è™Ÿ <strong>ND20250001</strong> çœ‹çœ‹æ•ˆæœã€‚
        </div>
      </div>
    </form>

    <div class="order-result" id="orderResult"></div>
  </section>

  <!-- å“ç‰Œæ•…äº‹ -->
  <section class="card" id="about">
    <h3 class="section-title">
      å“ç‰Œå°æ•…äº‹
      <span>å¾ã€Œæƒ³æŠŠæˆ¿é–“è®Šå¥¶æ²¹é»ƒä¸€é»ã€é–‹å§‹</span>
    </h3>
    <p>
      ä¸‰å°éš»æ—¥å¸¸å°ç‰©ç™¾è²¨ï¼Œæ˜¯å¾ä¸€é–“å°æˆ¿é–“é–‹å§‹çš„é¸ç‰©åº—ã€‚  
      æœ‰ä¸€å¤©ç™¼ç¾ï¼Œæˆ¿é–“è£¡åªè¦å¤šä¸€å…©å€‹é¡è‰²æŸ”æŸ”çš„æ±è¥¿ï¼Œ  
      å¿ƒæƒ…å°±æœƒä¸çŸ¥ä¸è¦ºæ¯”è¼ƒç©©å®šã€‚
    </p>
    <p>
      æ‰€ä»¥æˆ‘å€‘åªåšä¸€ä»¶äº‹ï¼š<strong>å¹«ä½ æŒ‘é‚£äº›ã€Œçœ‹äº†æœƒè¦ºå¾—äººç”Ÿå¥½åƒæ²’æœ‰é‚£éº¼è¾›è‹¦ã€çš„å°ç‰©ã€‚</strong>
    </p>
    <ul>
      <li>å¯¦éš›ä½¿ç”¨ã€æ‹ç…§ï¼Œä¸åªçœ‹å» å•†åœ–ã€‚</li>
      <li>é¡è‰²ä»¥å¥¶æ²¹é»ƒã€å¥¶èŒ¶è‰²ã€æœ¨é ­è‰²ç‚ºä¸»ï¼Œä¸åˆºæ¿€çœ¼ç›ã€‚</li>
      <li>åƒ¹éŒ¢æ§åˆ¶åœ¨ã€Œè‡ªå·±ä¹Ÿè²·å¾—ä¸‹æ‰‹ã€çš„ç¯„åœã€‚</li>
    </ul>
    <p>
      å¸Œæœ›ä½ æ‰“é–‹åŒ…è£¹çš„é‚£ä¸€åˆ»ï¼Œæœƒè¦ºå¾—ï¼š  
      å•Šï¼Œä»Šå¤©åˆå¤šäº†ä¸€é»é»å–œæ­¡ç”Ÿæ´»çš„ç†ç”±ã€‚ğŸ§ˆ
    </p>
  </section>

</main>

<footer>
  ä¸‰å°éš»æ—¥å¸¸ç™¾è²¨ï½œç™‚ç™’ç”Ÿæ´»ç™¾è²¨ Â· ç„¡æœƒå“¡åˆ¶é›»å•†ç¶²ç«™ç¤ºæ„ç‰ˆå‹<br>
  ä¹‹å¾Œå¯ä»¥åœ¨é€™è£¡æ”¾ä¸Šä½ çš„ IGã€è¦çš®è³£å ´ã€Line å®˜æ–¹å¸³è™Ÿé€£çµã€‚
</footer>

<script>
// ====== åœ–ç‰‡ç¶²å€è™•ç†ï¼ˆSupabaseï¼‰ ======
const SUPABASE_IMG_BASE =
  'https://ckqdimygblkasofycwvr.supabase.co/storage/v1/object/public/product-images/';

function resolveImgUrl(url) {
  if (!url) return '';
  if (/^https?:\/\//i.test(url)) return url;
  return SUPABASE_IMG_BASE + url.replace(/^\/+/, '');
}

// ====== å¾Œç«¯ API è¨­å®šï¼ˆå‰å°ç”¨ï¼‰ ======

// const API_BASE = 'http://localhost:3000';  // âŒ é€™è¡Œè¨»è§£æ‰
const API_BASE = window.location.origin;      // âœ… ä¸Šç·š / æœ¬æ©Ÿéƒ½é€šç”¨


async function apiPost(path, data) {
  const res = await fetch(API_BASE + path, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });
  if (!res.ok) {
    const text = await res.text().catch(() => '');
    throw new Error('API éŒ¯èª¤ï¼š' + res.status + ' ' + text);
  }
  return res.json();
}

async function apiGet(path) {
  const res = await fetch(API_BASE + path);
  if (!res.ok) {
    const text = await res.text().catch(() => '');
    throw new Error('API éŒ¯èª¤ï¼š' + res.status + ' ' + text);
  }
  return res.json();
}

async function apiPatch(path, data) {
  const res = await fetch(API_BASE + path, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });
  if (!res.ok) {
    const text = await res.text().catch(() => '');
    throw new Error('API éŒ¯èª¤ï¼š' + res.status + ' ' + text);
  }
  return res.json();
}

// ====== æ²å‹•åˆ°æŒ‡å®šå€å¡Š ======
function scrollToSection(id) {
  const el = document.getElementById(id);
  if (el) {
    el.scrollIntoView({ behavior: 'smooth' });
  }
}

// ====== å•†å“è³‡æ–™ï¼ˆæ”¹æˆç”±å¾Œç«¯è¼‰å…¥ï¼‰ ======
let products = [];

async function loadProducts() {
  try {
    const data = await apiGet('/api/products');
    const list = data.products || data.data || [];
    products = Array.isArray(list) ? list : [];
    console.log('è¼‰å…¥å•†å“æˆåŠŸï¼Œå…±æœ‰', products.length, 'å€‹å•†å“');
  } catch (err) {
    console.error('è¼‰å…¥å•†å“å¤±æ•—', err);
    products = [];
    alert('è¼‰å…¥å•†å“å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ä¸€æ¬¡ï¼Œæˆ–ç¢ºèªå¾Œç«¯ /api/products æ˜¯å¦æœ‰é–‹å•Ÿã€‚');
  }
}

// ====== å•†å“åˆ†é¡ç¯©é¸ ======
const categoryChips = document.querySelectorAll('.category-chip');
const productGrid = document.getElementById('productGrid');

categoryChips.forEach(chip => {
  chip.addEventListener('click', () => {
    categoryChips.forEach(c => c.classList.remove('active'));
    chip.classList.add('active');

    const category = chip.dataset.category;
    renderProductGrid(category);
  });
});

// ====== è³¼ç‰©è»Šè³‡æ–™çµæ§‹ ======
let cartItems = []; // {productId, specKey, qty, price, name, specLabel}
let cartCount = 0;
const cartBtnTop = document.querySelector('.nav-action .btn-primary');

function updateCartBtnText() {
  if (cartBtnTop) {
    cartBtnTop.textContent = `æŸ¥çœ‹è³¼ç‰©è»Šï¼ˆ${cartCount}ï¼‰`;
  }
}

function addToCart(productId, specKey, qty) {
  const product = products.find(p => p.id === productId);
  if (!product) return;

  const specList = product.specs || [];
  let useSpec = specList[0];

  if (specKey) {
    const found = specList.find(s => s.key === specKey);
    if (found) useSpec = found;
  }

  if (!useSpec) {
    useSpec = { key: 'default', label: 'é è¨­æ¬¾' };
  }

  qty = Number(qty) || 1;
  if (qty < 1) qty = 1;

  // è‹¥æœ‰è¨­å®šåº«å­˜å°±æª¢æŸ¥
  if (typeof useSpec.stock === 'number') {
    const currentInCartSpec = cartItems
      .filter(it => it.productId === productId && it.specKey === useSpec.key)
      .reduce((sum, it) => sum + it.qty, 0);

    if (currentInCartSpec + qty > useSpec.stock) {
      const remain = useSpec.stock - currentInCartSpec;
      alert(
        `ã€Œ${product.name} - ${useSpec.label}ã€åº«å­˜ä¸è¶³ï¼Œ` +
        `ç›®å‰æœ€å¤šé‚„èƒ½åŠ  ${remain < 0 ? 0 : remain} ä»¶ã€‚`
      );
      return;
    }
  }

  const exist = cartItems.find(
    item => item.productId === productId && item.specKey === useSpec.key
  );
  if (exist) {
    exist.qty += qty;
  } else {
    cartItems.push({
      productId,
      specKey: useSpec.key,
      name: product.name,
      specLabel: useSpec.label,
      price: product.price,
      qty
    });
  }

  cartCount = cartItems.reduce((sum, it) => sum + it.qty, 0);
  updateCartBtnText();
  renderCart();
}

function removeCartItem(index) {
  if (index < 0 || index >= cartItems.length) return;
  cartItems.splice(index, 1);
  cartCount = cartItems.reduce((sum, it) => sum + it.qty, 0);
  updateCartBtnText();
  renderCart();
}

function renderCart() {
  const container = document.getElementById('cartList');
  if (!container) return;

  if (cartItems.length === 0) {
    container.innerHTML = 'ï¼ˆä½ çš„è³¼ç‰©è»Šç›®å‰æ˜¯ç©ºçš„ï¼‰';
    return;
  }

  let html = '<ul style="padding-left:18px;">';
  let total = 0;
  cartItems.forEach((item, index) => {
    const lineTotal = item.price * item.qty;
    total += lineTotal;
    html += `
      <li style="margin-bottom:4px;">
        ${item.name}ï¼ˆ${item.specLabel}ï¼‰ Ã— ${item.qty}
        ï¼ NT$${lineTotal}
        <button type="button"
          onclick="removeCartItem(${index})"
          style="margin-left:6px;padding:2px 6px;font-size:11px;border-radius:6px;border:1px solid #e0c080;background:#fff9ec;cursor:pointer;">
          ç§»é™¤
        </button>
      </li>
    `;
  });
  html += '</ul>';
  html += `<div style="margin-top:8px;font-size:13px;color:#4f3b2a;">
            å°è¨ˆï¼š<strong>NT$ ${total}</strong>
          </div>`;
  container.innerHTML = html;
}

function calcCartTotal() {
  return cartItems.reduce((sum, it) => {
    const price = typeof it.price === 'number' ? it.price : 0;
    return sum + price * it.qty;
  }, 0);
}

window.removeCartItem = removeCartItem;

// ====== ç”¢ç”Ÿå•†å“åˆ—è¡¨ ======
function renderProductGrid(category = 'all') {
  if (!productGrid) return;
  productGrid.innerHTML = '';

  products.forEach(product => {
    const cats = product.categories || [];
    if (category !== 'all' && !cats.includes(category)) return;

    const specs = product.specs || [];
    const firstSpec = specs[0];

    // 1. å•†å“ä¸»åœ– â†’ 2. æ¬¾å¼ä¸»åœ– â†’ 3. æ¬¾å¼ç¬¬ä¸€å¼µå°åœ–
    const mainImgRaw =
      product.imageUrl ||
      (firstSpec && firstSpec.mainImg) ||
      (firstSpec && firstSpec.thumbs && firstSpec.thumbs[0]) ||
      '';

    const mainImg = resolveImgUrl(mainImgRaw);

    const article = document.createElement('article');
    article.className = 'product-card';
    article.dataset.id = product.id;
    article.dataset.category = cats.join(' ');
    article.dataset.selectedSpec = firstSpec ? firstSpec.key : '';

    article.innerHTML = `
      ${product.tag ? `<div class="product-tag">${product.tag}</div>` : ''}
      <div class="product-img" data-click="open-detail">
        ${mainImg ? `<img src="${mainImg}" alt="${product.name}">` : ''}
      </div>
      <h4 class="product-name" data-click="open-detail">${product.name}</h4>
      <div class="product-bottom">
        <div class="product-price-row">
          <div class="product-price">NT$ ${product.price}</div>
          <button type="button" class="product-like-btn">â™¡</button>
        </div>
        <div class="card-spec-row">
          ${specs
            .map(
              (spec, idx) =>
                `<button type="button"
                   class="card-spec-btn ${idx === 0 ? 'active' : ''}"
                   data-spec-key="${spec.key}">
                   ${spec.label}
                 </button>`
            )
            .join('')}
        </div>
        <div class="card-action-row">
          <div class="qty-control">
            <button type="button" class="qty-btn">âˆ’</button>
            <input type="text" class="qty-input" value="1">
            <button type="button" class="qty-btn">ï¼‹</button>
          </div>
          <button type="button" class="btn-cart">
            ğŸ›’ åŠ å…¥
          </button>
        </div>
      </div>
    `;

    // é»åœ–ç‰‡ / åç¨± â†’ è©³æƒ…
    article.querySelectorAll('[data-click="open-detail"]').forEach(el => {
      el.addEventListener('click', () => openProduct(product.id));
    });

    // æ„›å¿ƒ
    const likeBtn = article.querySelector('.product-like-btn');
    likeBtn.addEventListener('click', e => {
      e.stopPropagation();
      likeBtn.classList.toggle('active');
      likeBtn.textContent = likeBtn.classList.contains('active') ? 'â¤' : 'â™¡';
    });

    // å¡ç‰‡ä¸Šçš„æ¬¾å¼åˆ‡æ›
    const specBtns = article.querySelectorAll('.card-spec-btn');
    specBtns.forEach(btn => {
      btn.addEventListener('click', e => {
        e.stopPropagation();
        specBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        article.dataset.selectedSpec = btn.dataset.specKey || '';
      });
    });

    // å¡ç‰‡æ•¸é‡æŒ‰éˆ•
    const qtyInput = article.querySelector('.qty-input');
    const qtyBtns = article.querySelectorAll('.qty-btn');
    qtyBtns[0].addEventListener('click', e => {
      e.stopPropagation();
      let v = parseInt(qtyInput.value || '1', 10);
      if (isNaN(v) || v < 1) v = 1;
      v = Math.max(1, v - 1);
      qtyInput.value = v;
    });
    qtyBtns[1].addEventListener('click', e => {
      e.stopPropagation();
      let v = parseInt(qtyInput.value || '1', 10);
      if (isNaN(v) || v < 1) v = 1;
      v += 1;
      qtyInput.value = v;
    });

    // åŠ å…¥è³¼ç‰©è»Š
    const addBtn = article.querySelector('.btn-cart');
    addBtn.addEventListener('click', e => {
      e.stopPropagation();
      const specKey = article.dataset.selectedSpec || '';
      const qty = parseInt(qtyInput.value || '1', 10) || 1;
      addToCart(product.id, specKey, qty);
    });

    productGrid.appendChild(article);
  });
}

// ====== å•†å“è©³æƒ… ======
const productDetailSection = document.getElementById('productDetail');
const detailTitleMain = document.getElementById('detailTitleMain');
const detailSubtitle = document.getElementById('detailSubtitle');
const detailName = document.getElementById('detailName');
const detailSub = document.getElementById('detailSub');
const detailPrice = document.getElementById('detailPrice');
const detailPriceNote = document.getElementById('detailPriceNote');
const detailMainImg = document.getElementById('detailMainImg');
const detailThumbs = document.getElementById('detailThumbs');
const detailSpecs = document.getElementById('detailSpecs');
const detailDesc = document.getElementById('detailDesc');
const detailQtyInput = document.getElementById('detailQtyInput');
const detailQtyMinus = document.getElementById('detailQtyMinus');
const detailQtyPlus = document.getElementById('detailQtyPlus');
const detailAddBtn = document.getElementById('detailAddBtn');

let currentDetailProductId = null;
let currentDetailSpecKey = null;

function openProduct(productId) {
  const product = products.find(p => p.id === productId);
  if (!product) return;

  currentDetailProductId = productId;

  detailTitleMain.textContent = product.name;
  detailSubtitle.textContent = product.subtitle ? product.subtitle : '';
  detailName.textContent = product.name;
  detailSub.textContent = product.subtitle || '';
  detailPrice.textContent = product.price;
  detailPriceNote.textContent = product.priceNote || '';
  detailDesc.innerHTML = product.detailHtml || '';

  detailSpecs.innerHTML = '';
  (product.specs || []).forEach((spec, idx) => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'pd-spec-btn' + (idx === 0 ? ' active' : '');
    btn.textContent = spec.label;
    btn.dataset.specKey = spec.key;
    btn.addEventListener('click', () => {
      setDetailSpec(productId, spec.key);
    });
    detailSpecs.appendChild(btn);
  });

  if (product.specs && product.specs[0]) {
    setDetailSpec(productId, product.specs[0].key);
  }

  detailQtyInput.value = '1';

  productDetailSection.style.display = 'block';
  scrollToSection('productDetail');
}

function setDetailSpec(productId, specKey) {
  const product = products.find(p => p.id === productId);
  if (!product) return;

  const specs = product.specs || [];
  const spec = specs.find(s => s.key === specKey) || specs[0];
  if (!spec) return;

  currentDetailSpecKey = spec.key;

  // ä¸»åœ–ï¼šæ¬¾å¼ä¸»åœ– â†’ å•†å“ä¸»åœ– â†’ å°åœ–
  const mainImgRaw =
    spec.mainImg ||
    product.imageUrl ||
    (spec.thumbs && spec.thumbs[0]) ||
    '';

  const mainImg = resolveImgUrl(mainImgRaw);
  detailMainImg.src = mainImg;
  detailMainImg.alt = `${product.name} ${spec.label}`;

  // å°åœ–åˆ—è¡¨
  detailThumbs.innerHTML = '';
  const thumbList =
    (spec.thumbs && spec.thumbs.length > 0)
      ? spec.thumbs
      : [mainImgRaw];

  thumbList.forEach((srcRaw, idx) => {
    if (!srcRaw) return;
    const src = resolveImgUrl(srcRaw);

    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'pd-thumb-btn' + (idx === 0 ? ' active' : '');
    const img = document.createElement('img');
    img.src = src;
    img.alt = `${product.name} ${spec.label} åœ–ç‰‡`;
    btn.appendChild(img);
    btn.addEventListener('click', () => {
      detailMainImg.src = src;
      detailThumbs
        .querySelectorAll('.pd-thumb-btn')
        .forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
    detailThumbs.appendChild(btn);
  });

  // æ¬¾å¼æŒ‰éˆ• active ç‹€æ…‹
  detailSpecs
    .querySelectorAll('.pd-spec-btn')
    .forEach(btn => {
      btn.classList.toggle('active', btn.dataset.specKey === specKey);
    });
}

function backToProducts() {
  productDetailSection.style.display = 'none';
  scrollToSection('products');
}
window.backToProducts = backToProducts;

detailQtyMinus.addEventListener('click', () => {
  let v = parseInt(detailQtyInput.value || '1', 10);
  if (isNaN(v) || v < 1) v = 1;
  v = Math.max(1, v - 1);
  detailQtyInput.value = v;
});

detailQtyPlus.addEventListener('click', () => {
  let v = parseInt(detailQtyInput.value || '1', 10);
  if (isNaN(v) || v < 1) v = 1;
  v += 1;
  detailQtyInput.value = v;
});

detailAddBtn.addEventListener('click', () => {
  if (!currentDetailProductId) return;
  const qty = parseInt(detailQtyInput.value || '1', 10) || 1;
  addToCart(currentDetailProductId, currentDetailSpecKey, qty);
});

// ====== çµå¸³è¡¨å–®ï¼ˆå‘¼å«å¾Œç«¯ /api/ordersï¼‰ ======
const checkoutForm = document.getElementById('checkoutForm');
if (checkoutForm) {
  checkoutForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    if (cartItems.length === 0) {
      alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œè«‹å…ˆé¸å¹¾æ¨£å°ç‰©å†ä¾†çµå¸³å”·ï¼');
      return;
    }

    const name = document.getElementById('checkoutName').value.trim();
    const phone = document.getElementById('checkoutPhone').value.trim();
    const email = document.getElementById('checkoutEmail').value.trim();
    const lineId = document.getElementById('checkoutLine').value.trim();
    const address = document.getElementById('checkoutAddress').value.trim();
    const ship = document.getElementById('checkoutShip').value;
    const pay = document.getElementById('checkoutPay').value;
    const note = document.getElementById('checkoutNote').value.trim();

    if (!name || !phone || !email) {
      alert('å§“åã€é›»è©±ã€Email ç‚ºå¿…å¡«æ¬„ä½ï¼Œè«‹å†ç¢ºèªä¸€ä¸‹å”·ï½');
      return;
    }

    const payload = {
      items: cartItems.map(it => ({
        productId: it.productId,
        specKey: it.specKey,
        specLabel: it.specLabel,
        name: it.name,
        price: it.price,
        qty: it.qty
      })),
      customer: {
        name,
        phone,
        email,
        lineId,
        address,
        ship,
        pay,
        note
      }
    };

    try {
      const result = await apiPost('/api/orders', payload);

      const order =
        result.order ||
        result.data ||
        result;

      const orderId =
        result.orderId ||
        order.id ||
        order.orderId ||
        'ï¼ˆè«‹çœ‹å¾Œå°ï¼‰';

      const createdAt =
        order.createdAt ||
        result.createdAt ||
        'å‰›å‰›';

      const status =
        order.status ||
        result.status ||
        'new';

      const total =
        typeof result.totalAmount === 'number'
          ? result.totalAmount
          : typeof order.totalAmount === 'number'
            ? order.totalAmount
            : calcCartTotal();

      alert(
        'è¨‚å–®å·²å»ºç«‹å›‰ï¼\n\n' +
        'è¨‚å–®ç·¨è™Ÿï¼š' + orderId + '\n' +
        'å»ºç«‹æ™‚é–“ï¼š' + createdAt + '\n' +
        'è¨‚å–®ç‹€æ…‹ï¼š' + status + '\n' +
        'ç¸½é‡‘é¡ï¼šNT$ ' + total + '\n\n' +
        'ä¹‹å¾Œå¯ä»¥ç”¨ã€Œé›»è©± + è¨‚å–®ç·¨è™Ÿã€åœ¨ä¸‹æ–¹è¨‚å–®æŸ¥è©¢å€æŸ¥çœ‹é€²åº¦ã€‚'
      );

      // âœ… æˆåŠŸå¾Œç›´æ¥æ•´é é‡æ•´ï¼šæœƒé‡æŠ“å•†å“ï¼ˆå«æœ€æ–°åº«å­˜ï¼‰ã€æ¸…ç©ºè³¼ç‰©è»Š
      window.location.reload();

    } catch (err) {
      console.error('POST /api/orders error', err);
      alert(
        'å»ºç«‹è¨‚å–®æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œå¯èƒ½æ˜¯ç¶²è·¯æˆ–ä¼ºæœå™¨æš«æ™‚æœ‰å•é¡Œï¼Œ\n' +
        'è«‹ç¨å¾Œå†è©¦ä¸€æ¬¡ï¼Œæˆ–æ”¹ç”¨è¦çš® / Line è¯çµ¡åº—ä¸»ã€‚\n\n' +
        err.message
      );
    }
  });
}


// ====== åˆå§‹åŒ– ======
async function initPage() {
  updateCartBtnText();
  await loadProducts();
  renderProductGrid('all');
  renderCart();
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initPage);
} else {
  initPage();
}
</script>

</body>
</html>
